# 项目更新说明

## 2023年11月27日更新

### 应用苹果设计风格

对整个博客系统应用了苹果设计风格，提升了视觉效果和用户体验：

1. 设计元素更新：
   - 增加磨砂玻璃效果（Glassmorphism）
   - 优化排版和间距
   - 添加精致的动画和过渡效果
   - 使用更符合苹果风格的配色方案
   - 增强3D与UI的融合体验

2. 组件更新：
   - 重新设计Header组件，增加透明效果和动画
   - 更新文章卡片设计，使用圆角和微妙阴影
   - 改进3D场景，增加粒子效果和光晕
   - 优化移动端适配和响应式设计
   - 添加更多交互动画效果

3. 3D效果增强：
   - 为3D模型添加发光效果
   - 优化相机控制和过渡效果
   - 增加闪光粒子系统
   - 为不同类型的文章提供独特的3D视觉标识

这些更新使博客系统具有了现代、优雅的外观，同时保持了良好的性能和可访问性。

## 2023年11月26日更新

### 修复Node.js模块在客户端使用的问题

修复了"Module not found: Can't resolve 'fs'"错误，这个错误是因为在客户端组件中使用了Node.js的文件系统模块。

解决方案：
1. 将`markdown.ts`文件标记为服务器组件（添加'use server'指令）
2. 重构页面组件，将其分为服务器组件和客户端组件：
   - 服务器组件负责数据获取
   - 客户端组件负责UI渲染和3D交互

具体更改：
- 添加了`ClientPage.tsx`、`PostClientPage.tsx`和`TagClientPage.tsx`组件
- 修改了`app/page.tsx`、`app/posts/[slug]/page.tsx`和`app/tags/[tag]/page.tsx`为服务器组件
- 服务器组件获取数据后将其传递给客户端组件进行渲染

这种模式符合Next.js 14的最佳实践，使用服务器组件进行数据获取，客户端组件处理交互和UI渲染。

## 2023年11月25日更新

### 依赖版本更新

为解决构建错误 "Attempted import error: 'BatchedMesh' is not exported from 'three'"，我们更新了以下依赖：

1. `three` 从 v0.154.0 升级到 v0.159.0
2. `@react-three/drei` 从 v9.80.0 升级到 v9.92.7
3. `@react-three/fiber` 从 v8.13.6 升级到 v8.15.12
4. `next` 确认使用 v14.2.24

### 代码调整

1. 移除 `next.config.js` 中已弃用的 `experimental.appDir` 选项，因为 App Router 在 Next.js 14 中已经是默认功能
2. 更新 `Text` 组件的用法，以适应最新版本的 `@react-three/drei`
3. 添加 `public/fonts` 目录，用于存放博客系统使用的字体文件

### 解决方案说明

这个错误发生的原因是 `three-mesh-bvh` 这个依赖库（由 `@react-three/drei` 使用）尝试从 Three.js 中导入 `BatchedMesh` 类，但是在旧版本的 Three.js 中这个类不存在。

`BatchedMesh` 是 Three.js r159 版本中引入的新特性，它允许将多个网格合并为一个单一的批处理网格，从而显著提高渲染性能。

### 如何运行更新后的项目

1. 清除旧的依赖和缓存：
   ```bash
   rm -rf node_modules .next
   npm cache clean --force
   ```

2. 安装新的依赖：
   ```bash
   npm install
   ```

3. 启动开发服务器：
   ```bash
   npm run dev
   ```

如果在启动过程中仍然遇到问题，可能需要下载并添加字体文件到 `public/fonts` 目录，或者修改 `BlogHomeScene.tsx` 文件中的 `Text` 组件，移除对字体文件的引用。

## 2023年11月28日更新

### 新增功能

1. **文章列表页面**
   - 创建了完整的文章列表页面 (`/posts` 路由)
   - 添加了文章搜索功能，支持按标题和摘要搜索
   - 实现了标签筛选功能，可以按特定标签查看文章
   - 优雅的苹果风格UI设计，包括磨砂玻璃效果和平滑动画
   - 响应式布局，适配各种设备屏幕

2. **图片支持功能**
   - 修改了Markdown处理逻辑，支持在文章中显示图片
   - 创建了专用的`/public/images`目录用于存储文章图片
   - 实现了图片路径的自动转换，简化了图片引用过程
   - 添加了一篇包含图片的示例文章，展示图片功能

3. **导航优化**
   - 更新了导航菜单，添加了文章列表页面的链接
   - 优化了导航项的激活状态显示效果

### 代码改进

1. **Markdown处理优化**
   - 增强了`markdown.ts`文件，添加了图片路径处理逻辑
   - 使用正则表达式识别并转换Markdown中的图片路径
   - 确保图片和文章目录存在，提高系统稳定性
   - 添加了按标签获取文章的功能

2. **组件架构优化**
   - 创建了`PostsClientPage.tsx`客户端组件，实现文章列表界面
   - 遵循Next.js 14最佳实践，分离数据获取和UI渲染
   - 添加了`PostsScene.tsx`3D场景组件，创建沉浸式背景

### 文档更新

1. **更新了README.md**
   - 添加了文章列表页面的功能说明
   - 增加了图片管理和显示的使用指南
   - 完善了内容管理部分的说明

### 使用说明

1. **查看文章列表**
   - 通过导航菜单点击"文章列表"进入
   - 可使用搜索框按关键词筛选文章
   - 点击标签按钮按特定标签查看文章

2. **添加带图片的文章**
   - 将图片文件放入`public/images`目录
   - 在Markdown文章中使用`![描述](图片名称.jpg)`格式引用图片
   - 系统会自动处理图片路径 